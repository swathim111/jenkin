pipeline{
agent any
stages{
stage('Build'){
steps{
sh 'printenv'
}
}
stage('ecrlogin'){
steps{
withCredentials([[
    $class: 'AmazonWebServicesCredentialsBinding',
    credentialsId:"aws1",
    accessKeyVariable: 'AWS_ACCESS_KEY_ID',
    secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'
]]) 

{
sh 'aws ecr-public get-login-password --region us-east-1 | docker login --username AWS --password-stdin public.ecr.aws/o4p0t3e5'
sh 'docker build -t ecr1 .'
sh 'docker tag ecr1:latest public.ecr.aws/o4p0t3e5/ecr1:latest'
sh 'docker push public.ecr.aws/o4p0t3e5/ecr1:latest'
}
}
}
}
}





